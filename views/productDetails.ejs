<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">
  <title><%= product.productName %> — Supermarket</title>
  <style>
    body { background: #f8fff4; font-family: "Poppins", Arial, sans-serif; }
    .product-hero { padding: 36px 0 56px; }
    .product-img { width:100%; height:420px; object-fit:contain; background:#fff; border-radius:8px; box-shadow:0 6px 18px rgba(0,0,0,0.06); }
    .price { font-size:2rem; font-weight:700; color:#0b4a06; }
    .product-name { font-size:1.4rem; font-weight:700; }
    .stock { font-weight:600; color:#333; }
    .category-badge { background:#e8f8ef; color:#0b6623; border-radius:999px; padding:6px 12px; font-weight:600; display:inline-block; }
    .back-link { text-decoration:none; color:#0b6623; font-weight:600; }
    .card-ghost { background:transparent; border:none; }
    .toast-inline { position:fixed; top:16px; right:16px; z-index:1050; display:none; }
  </style>
</head>
<body>

  <%- include('partials/usernavbar') %>

  <div class="container product-hero">
    <div class="mb-3 d-flex justify-content-between align-items-center">
      <div>
        <a href="/shopping<%= product.categoryId ? ('?categoryId=' + product.categoryId) : '' %>" class="back-link">
          <i class="bi bi-arrow-left"></i> Back to shopping
        </a>
      </div>
      <div>
        <% if (product.categoryName) { %>
          <a href="/shopping?categoryId=<%= product.categoryId %>" class="category-badge"><i class="bi bi-tag-fill"></i> <%= product.categoryName %></a>
        <% } %>
      </div>
    </div>

    <div class="row g-4 align-items-center">

      <div class="col-12 col-md-6">
        <div class="card card-ghost p-3">
          <img src="/images/<%= product.image || 'bgproduct.png' %>" alt="<%= product.productName %>" class="product-img">
        </div>
      </div>

      <div class="col-12 col-md-6">
        <div class="mb-3">
          <div class="price">$<%= product.price.toFixed(2) %></div>
          <div class="product-name mt-2"><%= product.productName %></div>
        </div>

        <p class="stock mb-3">Stock: <strong><%= product.quantity %></strong></p>

        <% if (product.quantity > 0) { %>
          <form action="/add-to-cart/<%= product.id %>" method="POST" class="w-100">
            <div class="input-group mb-3" style="max-width:240px;">
              <button class="btn btn-outline-success qty-btn" data-id="<%= product.id %>" data-delta="-1" type="button">−</button>
              <input type="text" id="qty-<%= product.id %>" name="quantity" value="1" class="form-control text-center" style="width:90px;" readonly>
              <button class="btn btn-outline-success qty-btn" data-id="<%= product.id %>" data-delta="1" data-max="<%= product.quantity %>" type="button">+</button>
            </div>

            <button class="btn btn-success btn-lg">
              <i class="bi bi-cart3"></i> Add to cart
            </button>
          </form>
        <% } else { %>
          <button class="btn btn-secondary btn-lg" disabled>Unavailable</button>
        <% } %>

        <div class="mt-4">
          <% if (product.description) { %>
            <h5>Description</h5>
            <p><%= product.description %></p>
          <% } %>
        </div>

      </div>
    </div>
  </div>

  <div id="stockToast" class="toast-inline alert alert-danger">You cannot add more than available stock!</div>

  <script>
    const stockToast = document.getElementById('stockToast');

    document.addEventListener('click', e => {
      if (!e.target.classList.contains('qty-btn')) return;
      const id = e.target.dataset.id;
      const delta = parseInt(e.target.dataset.delta);
      const max = parseInt(e.target.dataset.max);
      const input = document.getElementById('qty-' + id);
      let qty = parseInt(input.value);
      qty += delta;
      if (qty < 1) qty = 1;
      if (!isNaN(max) && qty > max) {
        qty = max;
        stockToast.style.display = 'block';
        setTimeout(() => stockToast.style.display = 'none', 2200);
      }
      input.value = qty;
    });
  </script>

</body>
</html>
